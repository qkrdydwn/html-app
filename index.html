<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¿ íŒ¡ ì‘ì—… ê´€ë¦¬</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Arial", sans-serif; }
        body { background-color: #f5f5f5; }
        
        .header { 
            background-color: #2196F3; 
            color: white; 
            padding: 16px; 
            text-align: center; 
            position: fixed; 
            top: 0; 
            width: 100%; 
            z-index: 1000;
        }
        
        .header h1 { text-align: center; }
        
        .content {
            margin-top: 80px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .work-type-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            width: 100%;
        }

        .my-info-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            width: 100%;
            text-align: center;
            margin-top: 10px;
            border: 2px dashed #2196F3;
        }

        .watch-card {
            background: #fff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            width: 100%;
            margin-bottom: 20px;
            border: 2px solid #2196F3;
        }

        .watch-status {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .watch-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .heart-rate {
            font-size: 28px;
            font-weight: bold;
            color: #e91e63;
        }

        .watch-controls {
            display: flex;
            gap: 10px;
        }

        .watch-button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s;
        }

        .connect-button {
            background: #2196F3;
            color: white;
        }

        .disconnect-button {
            background: #f44336;
            color: white;
            display: none;
        }

        .watch-button:hover {
            opacity: 0.9;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ccc;
        }

        .status-connected {
            background: #4CAF50;
        }

        .my-info-card:hover {
            transform: translateY(-5px);
            background: #e3f2fd;
        }
        .work-type-card:hover {
            transform: translateY(-5px);
        }
        
        .detail-screen, .history-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 2000;
            overflow-y: auto;
        }
        
        .detail-header {
            background: #2196F3;
            color: white;
            padding: 16px;
            display: flex;
            align-items: center;
        }
        
        .back-button {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            margin-right: 16px;
        }
        
        .detail-content {
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        .detail-content h3 {
            color: #1976D2;
            margin: 20px 0 10px 0;
            padding-bottom: 5px;
            border-bottom: 2px solid #e3f2fd;
        }

        .detail-content ul {
            list-style: none;
            margin-left: 20px;
        }

        .detail-content li {
            margin: 10px 0;
            padding-left: 20px;
            position: relative;
        }

        .detail-content li:before {
            content: "â€¢";
            color: #2196F3;
            font-weight: bold;
            position: absolute;
            left: 0;
        }
        
        .fatigue-controls {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .heart-rate-settings {
            margin-bottom: 20px;
            padding: 15px;
            background: #fff;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .heart-rate-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 14px;
        }

        .heart-rate-table th,
        .heart-rate-table td {
            padding: 8px;
            text-align: center;
            border: 1px solid #e0e0e0;
        }

        .heart-rate-table th {
            background: #f5f5f5;
            font-weight: bold;
        }

        .heart-rate-range-inputs {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-top: 15px;
        }

        .heart-rate-range-input {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .heart-rate-range-input input {
            width: 80px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .heart-rate-alert {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }

        .heart-rate-alert.warning {
            background: #fff3e0;
            color: #e65100;
            border: 1px solid #ffb74d;
        }

        .heart-rate-alert.danger {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ef5350;
        }
        
        .fatigue-slider {
            width: 100%;
            margin: 10px 0;
            height: 20px;
        }
        
        .save-button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 20px;
            font-size: 16px;
            width: 100%;
        }
        
        .save-button:hover {
            background: #1976D2;
        }

        .history-item {
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 12px;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid;
            position: relative;
            user-select: none;
            touch-action: none;
        }

        .history-date {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        .fatigue-bar-container {
            width: 100%;
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            margin: 5px 0;
            overflow: hidden;
        }

        .fatigue-bar {
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .fatigue-group {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .fatigue-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }

        .fatigue-value {
            font-weight: bold;
        }

        .history-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .history-title h3 {
            margin: 0;
        }

        .delete-options {
            display: none;
            position: absolute;
            right: 10px;
            top: 10px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 1;
        }

        .delete-option {
            padding: 8px 16px;
            cursor: pointer;
            color: #333;
            transition: background-color 0.2s;
        }

        .delete-option:hover {
            background: #f5f5f5;
        }

        .delete-option.delete-all {
            color: #dc3545;
            border-top: 1px solid #eee;
        }

        .heart-rate-display {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .heart-rate-value {
            font-size: 48px;
            font-weight: bold;
            color: #e91e63;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .heart-rate-status {
            font-size: 16px;
            color: #666;
        }

        .heart-rate-status.normal {
            color: #4CAF50;
        }

        .heart-rate-status.warning {
            color: #FF9800;
        }

        .heart-rate-status.danger {
            color: #f44336;
        }

        .heart-rate-chart {
            width: 100%;
            height: 100px;
            margin-top: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }

        .heart-rate-bar {
            position: absolute;
            bottom: 0;
            width: 4px;
            background: #e91e63;
            transition: height 0.3s ease;
        }

        .heart-rate-info {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }

        .heart-rate-range {
            display: flex;
            gap: 20px;
        }

        .range-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .range-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .range-normal { background: #4CAF50; }
        .range-warning { background: #FF9800; }
        .range-danger { background: #f44336; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ì‘ì—… ìœ í˜• ì„ íƒ</h1>
    </div>
    <div class="content" id="mainScreen">
        <div class="watch-card">
            <div class="watch-status">
                <div class="watch-info">
                    <div class="status-indicator" id="watchStatus"></div>
                    <span id="watchStatusText">ì›Œì¹˜ ì—°ê²° ëŒ€ê¸°ì¤‘</span>
                </div>
            </div>
            <div class="heart-rate-display">
                <div class="heart-rate-value">
                    <span>â¤ï¸</span>
                    <span id="heartRate">--</span>
                    <span>bpm</span>
                </div>
                <div class="heart-rate-status" id="heartRateStatus">ì—°ê²° ëŒ€ê¸°ì¤‘</div>
            </div>
            <div class="heart-rate-chart" id="heartRateChart"></div>
            <div class="heart-rate-info">
                <div class="heart-rate-range">
                    <div class="range-item">
                        <div class="range-dot range-normal"></div>
                        <span>ì •ìƒ (60-100)</span>
                    </div>
                    <div class="range-item">
                        <div class="range-dot range-warning"></div>
                        <span>ì£¼ì˜ (100-120)</span>
                    </div>
                    <div class="range-item">
                        <div class="range-dot range-danger"></div>
                        <span>ìœ„í—˜ (150+)</span>
                    </div>
                </div>
                <div id="lastUpdate">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: --:--:--</div>
            </div>
            <div class="watch-controls">
                <button class="watch-button connect-button" id="connectWatch">ì›Œì¹˜ ì—°ê²°</button>
                <button class="watch-button disconnect-button" id="disconnectWatch">ì—°ê²° í•´ì œ</button>
            </div>
        </div>
    </div>
    
    <div class="detail-screen" id="detailScreen">
        <div class="detail-header" id="detailHeader">
            <button class="back-button" onclick="showMainScreen()">â†</button>
            <h2 id="detailTitle"></h2>
        </div>
        <div class="detail-content" id="detailContent"></div>
    </div>
    
    <div class="history-screen" id="historyScreen">
        <div class="detail-header">
            <button class="back-button" onclick="showMainScreen()">â†</button>
            <h2>ë‚´ ì‘ì—… ê¸°ë¡</h2>
        </div>
        <div class="detail-content" id="historyContent"></div>
    </div>

    <script>
        const workTypes = [
            {
                id: 'picking',
                title: 'í”¼í‚¹',
                icon: 'ğŸ›’',
                color: '#4CAF50',
                description: 'ìƒí’ˆì„ ì„ ë°˜ì—ì„œ ì°¾ì•„ ìˆ˜ì§‘í•˜ëŠ” ì‘ì—…',
                requirements: [
                    'ì •í™•í•œ ìƒí’ˆ ì‹ë³„ëŠ¥ë ¥',
                    'ì‹ ì†í•œ ì´ë™ëŠ¥ë ¥',
                    'ì²´ë ¥',
                    'ì§‘ì¤‘ë ¥',
                    'ê³µê°„ íŒŒì•… ëŠ¥ë ¥'
                ],
                precautions: [
                    'ë¬´ê±°ìš´ ë¬¼ê±´ì€ í—ˆë¦¬ë¥¼ êµ½íˆì§€ ë§ê³  ë¬´ë¦ì„ êµ½í˜€ ë“¤ì–´ì˜¬ë¦¬ê¸°',
                    'ìƒí’ˆ ìœ„ì¹˜ í™•ì¸ í›„ ì´ë™í•˜ê¸°',
                    'ê³„ë‹¨ ì´ìš© ì‹œ ë‚œê°„ ì¡ê¸°',
                    'ë¬´ë¦¬í•œ ë™ì‘ í”¼í•˜ê¸°',
                    'í”¼ë¡œë„ë¥¼ ì²´í¬í•˜ë©° ì ì ˆí•œ íœ´ì‹ ì·¨í•˜ê¸°'
                ],
                equipment: [
                    'ìŠ¤ìºë„ˆ',
                    'ì¹´íŠ¸',
                    'ì•ˆì „í™”'
                ],
                initialFatigue: {
                    physical: 75,
                    mental: 60,
                    stress: 65,
                    bodyParts: {
                        neck: 65,
                        back: 80,
                        shoulder: 70,
                        leg: 85,
                        wrist: 60
                    }
                }
            },
            {
                id: 'packing',
                title: 'íŒ¨í‚¹',
                icon: 'ğŸ“¦',
                color: '#2196F3',
                description: 'ìƒí’ˆì„ í¬ì¥í•˜ê³  ë°°ì†¡ ì¤€ë¹„í•˜ëŠ” ì‘ì—…',
                requirements: [
                    'ì‹ ì†í•œ í¬ì¥ëŠ¥ë ¥',
                    'ì •í™•í•œ ë¼ë²¨ë§',
                    'ê¼¼ê¼¼í•¨',
                    'ì†ì¬ì£¼',
                    'ì²´ë ¥'
                ],
                precautions: [
                    'í¬ì¥ ê·œê²© ì¤€ìˆ˜í•˜ê¸°',
                    'ë¼ë²¨ ì •í™•íˆ ë¶€ì°©í•˜ê¸°',
                    'ë‚ ì¹´ë¡œìš´ ë„êµ¬ ì‚¬ìš© ì‹œ ì£¼ì˜',
                    'ë°˜ë³µ ë™ì‘ ì‹œ ì†ëª© ìŠ¤íŠ¸ë ˆì¹­í•˜ê¸°',
                    'í¬ì¥ì¬ ì •ë¦¬ì •ëˆ ì² ì €íˆ í•˜ê¸°'
                ],
                equipment: [
                    'í…Œì´í”„ê±´',
                    'ë°•ìŠ¤',
                    'ë¼ë²¨í”„ë¦°í„°'
                ],
                initialFatigue: {
                    physical: 65,
                    mental: 70,
                    stress: 60,
                    bodyParts: {
                        neck: 70,
                        back: 60,
                        shoulder: 75,
                        leg: 50,
                        wrist: 85
                    }
                }
            },
            {
                id: 'sorting',
                title: 'ì†ŒíŒ…',
                icon: 'ğŸ”„',
                color: '#FF9800',
                description: 'ìƒí’ˆì„ ì¢…ë¥˜ë³„, ë°°ì†¡ì§€ë³„ë¡œ ë¶„ë¥˜í•˜ëŠ” ì‘ì—…',
                requirements: [
                    'ì‹ ì†í•œ íŒë‹¨ë ¥',
                    'ì •í™•í•œ ë¶„ë¥˜ëŠ¥ë ¥',
                    'ì§‘ì¤‘ë ¥',
                    'ì²´ë ¥',
                    'ê³µê°„ í™œìš© ëŠ¥ë ¥'
                ],
                precautions: [
                    'ìƒí’ˆ ë¶„ë¥˜ ê¸°ì¤€ ì •í™•íˆ í™•ì¸í•˜ê¸°',
                    'ë¬´ê±°ìš´ ë¬¼ê±´ ë“¤ì–´ì˜¬ë¦´ ë•Œ í—ˆë¦¬ ì¡°ì‹¬í•˜ê¸°',
                    'ì´ë™ ê²½ë¡œ í™•ë³´í•˜ê¸°',
                    'ë¶„ë¥˜ëœ ìƒí’ˆ ì •í™•íˆ ë¼ë²¨ë§í•˜ê¸°',
                    'ì‘ì—…ì¥ ì •ë¦¬ì •ëˆ ìœ ì§€í•˜ê¸°'
                ],
                equipment: [
                    'ë¶„ë¥˜ í…Œì´ë¸”',
                    'ìŠ¤ìºë„ˆ',
                    'ë¼ë²¨'
                ],
                initialFatigue: {
                    physical: 70,
                    mental: 75,
                    stress: 70,
                    bodyParts: {
                        neck: 75,
                        back: 75,
                        shoulder: 65,
                        leg: 70,
                        wrist: 60
                    }
                }
            },
            {
                id: 'loading',
                title: 'ìƒí•˜ì°¨',
                icon: 'ğŸš›',
                color: '#9C27B0',
                description: 'ìƒí’ˆì„ ì°¨ëŸ‰ì— ì‹£ê³  ë‚´ë¦¬ëŠ” ì‘ì—…',
                requirements: [
                    'ì²´ë ¥',
                    'ì•ˆì „ì˜ì‹',
                    'íŒ€ì›Œí¬',
                    'ì‹ ì†ì„±',
                    'ê³µê°„ í™œìš© ëŠ¥ë ¥'
                ],
                precautions: [
                    'ì¤‘ëŸ‰ë¬¼ ì·¨ê¸‰ ì‹œ íŒ€ì›ê³¼ í˜‘ë ¥í•˜ê¸°',
                    'ì°¨ëŸ‰ ì´ë™ ì‹œ ì£¼ë³€ í™•ì¸í•˜ê¸°',
                    'ì ì¬ í•œë„ ì¤€ìˆ˜í•˜ê¸°',
                    'ë¯¸ë„ëŸ¼ ë°©ì§€ë¥¼ ìœ„í•œ ì•ˆì „í™” ì°©ìš©í•˜ê¸°',
                    'ë‚ ì”¨ ì¡°ê±´ í™•ì¸í•˜ê³  ëŒ€ë¹„í•˜ê¸°'
                ],
                equipment: [
                    'ì§€ê²Œì°¨',
                    'ìš´ë°˜ì¹´íŠ¸',
                    'ì•ˆì „ëª¨'
                ],
                initialFatigue: {
                    physical: 85,
                    mental: 55,
                    stress: 75,
                    bodyParts: {
                        neck: 80,
                        back: 90,
                        shoulder: 85,
                        leg: 80,
                        wrist: 70
                    }
                }
            },
            {
                id: 'walking',
                title: 'ì›Œí‚¹',
                icon: 'ğŸ‘£',
                color: '#795548',
                description: 'ë¬¼ë¥˜ì„¼í„° ë‚´ ë³´í–‰ ì´ë™ ì‘ì—…',
                requirements: [
                    'ì²´ë ¥',
                    'ë°©í–¥ê°ê°',
                    'ì•ˆì „ì˜ì‹',
                    'ì‹ ì†ì„±',
                    'ì§‘ì¤‘ë ¥'
                ],
                precautions: [
                    'ì§€ì •ëœ ë³´í–‰ë¡œ ì´ìš©í•˜ê¸°',
                    'ì£¼ë³€ ì°¨ëŸ‰ ë° ì¥ë¹„ ì£¼ì˜í•˜ê¸°',
                    'ì ì ˆí•œ ë³´í–‰ ì†ë„ ìœ ì§€í•˜ê¸°',
                    'ë¯¸ë„ëŸ¬ìš´ ë°”ë‹¥ ì£¼ì˜í•˜ê¸°',
                    'ì¥ì‹œê°„ ë³´í–‰ ì‹œ íœ´ì‹ ì·¨í•˜ê¸°'
                ],
                equipment: [
                    'ì•ˆì „í™”',
                    'ë¬´ì „ê¸°',
                    'ì‘ì—…ë³µ'
                ],
                initialFatigue: {
                    physical: 70,
                    mental: 45,
                    stress: 50,
                    bodyParts: {
                        neck: 45,
                        back: 65,
                        shoulder: 40,
                        leg: 90,
                        wrist: 30
                    }
                }
            },
            {
                id: 'equipment',
                title: 'ì¥ë¹„ìš´ìš©',
                icon: 'ğŸšœ',
                color: '#607D8B',
                description: 'ì§€ê²Œì°¨, ìš´ë°˜ê¸°ê¸° ë“± ì¥ë¹„ ì¡°ì‘ ì‘ì—…',
                requirements: [
                    'ì¥ë¹„ ì¡°ì‘ ëŠ¥ë ¥',
                    'ì•ˆì „ ì˜ì‹',
                    'ì£¼ì˜ë ¥',
                    'íŒë‹¨ë ¥',
                    'íŒ€ì›Œí¬'
                ],
                precautions: [
                    'ì¥ë¹„ ì‹œë™ ì „ ì•ˆì „ì ê²€ ì‹¤ì‹œí•˜ê¸°',
                    'ê·œì • ì†ë„ ì¤€ìˆ˜í•˜ê¸°',
                    'í™”ë¬¼ ì ì¬ í•œë„ í™•ì¸í•˜ê¸°',
                    'ì£¼ë³€ ì‘ì—…ì ì•ˆì „ í™•ì¸í•˜ê¸°',
                    'ì¥ë¹„ ì´ìƒ ì‹œ ì¦‰ì‹œ ë³´ê³ í•˜ê¸°'
                ],
                equipment: [
                    'ì§€ê²Œì°¨',
                    'ì•ˆì „ëª¨',
                    'ë¬´ì „ê¸°'
                ],
                initialFatigue: {
                    physical: 60,
                    mental: 80,
                    stress: 75,
                    bodyParts: {
                        neck: 85,
                        back: 70,
                        shoulder: 65,
                        leg: 55,
                        wrist: 75
                    }
                }
            },
            {
                id: 'other',
                title: 'ê¸°íƒ€ì‘ì—…',
                icon: 'ğŸ”§',
                color: '#455A64',
                description: 'ê¸°íƒ€ ë¬¼ë¥˜ì„¼í„° ë‚´ ë³´ì¡° ì‘ì—…',
                requirements: [
                    'ê¸°ë³¸ ì²´ë ¥',
                    'í˜‘ë™ì‹¬',
                    'ì˜ì‚¬ì†Œí†µ ëŠ¥ë ¥',
                    'ì ì‘ë ¥',
                    'ë¬¸ì œí•´ê²° ëŠ¥ë ¥'
                ],
                precautions: [
                    'ì‘ì—… ì§€ì‹œì‚¬í•­ ì •í™•íˆ í™•ì¸í•˜ê¸°',
                    'ì•ˆì „ìˆ˜ì¹™ ì¤€ìˆ˜í•˜ê¸°',
                    'ë™ë£Œì™€ ì›í™œí•œ ì†Œí†µí•˜ê¸°',
                    'ì‘ì—…í™˜ê²½ ì •ë¦¬ì •ëˆí•˜ê¸°',
                    'ì´ìƒìƒí™© ë°œìƒ ì‹œ ì¦‰ì‹œ ë³´ê³ í•˜ê¸°'
                ],
                equipment: [
                    'ê¸°ë³¸ ê³µêµ¬',
                    'ì•ˆì „í™”',
                    'ì‘ì—…ë³µ'
                ],
                initialFatigue: {
                    physical: 55,
                    mental: 50,
                    stress: 45,
                    bodyParts: {
                        neck: 50,
                        back: 60,
                        shoulder: 55,
                        leg: 65,
                        wrist: 50
                    }
                }
            }
        ];

        let watchDevice = null;
        let heartRateCharacteristic = null;
        let isWatchConnected = false;
        let heartRateHistory = [];
        const MAX_HISTORY = 20;

        async function connectWatch() {
            try {
                watchDevice = await navigator.bluetooth.requestDevice({
                    filters: [
                        { namePrefix: "Galaxy Watch" },
                        { services: ['heart_rate'] }
                    ]
                });

                const server = await watchDevice.gatt.connect();
                const service = await server.getPrimaryService('heart_rate');
                heartRateCharacteristic = await service.getCharacteristic('heart_rate_measurement');
                
                await heartRateCharacteristic.startNotifications();
                heartRateCharacteristic.addEventListener('characteristicvaluechanged', handleHeartRateData);
                
                isWatchConnected = true;
                updateWatchStatus(true);
                document.getElementById('connectWatch').style.display = 'none';
                document.getElementById('disconnectWatch').style.display = 'block';
            } catch (error) {
                console.error('ì›Œì¹˜ ì—°ê²° ì‹¤íŒ¨:', error);
                alert('ì›Œì¹˜ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        function disconnectWatch() {
            if (heartRateCharacteristic) {
                heartRateCharacteristic.removeEventListener('characteristicvaluechanged', handleHeartRateData);
                heartRateCharacteristic.stopNotifications();
            }
            if (watchDevice && watchDevice.gatt.connected) {
                watchDevice.gatt.disconnect();
            }
            isWatchConnected = false;
            updateWatchStatus(false);
            document.getElementById('connectWatch').style.display = 'block';
            document.getElementById('disconnectWatch').style.display = 'none';
            document.getElementById('heartRate').textContent = '--';
            document.getElementById('heartRateStatus').textContent = 'ì—°ê²° í•´ì œë¨';
            document.getElementById('heartRateStatus').className = 'heart-rate-status';
            heartRateHistory = [];
            updateHeartRateChart();
        }

        function handleHeartRateData(event) {
            const value = event.target.value;
            const heartRate = value.getUint8(1);
            const timestamp = new Date();
            
            // ì‹¬ë°•ìˆ˜ ë°ì´í„° ì €ì¥
            heartRateHistory.push(heartRate);
            if (heartRateHistory.length > MAX_HISTORY) {
                heartRateHistory.shift();
            }
            
            // UI ì—…ë°ì´íŠ¸
            document.getElementById('heartRate').textContent = heartRate;
            document.getElementById('lastUpdate').textContent = 
                `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${timestamp.toLocaleTimeString()}`;
            
            // ìƒíƒœ ì—…ë°ì´íŠ¸
            updateHeartRateStatus(heartRate);
            
            // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            updateHeartRateChart();

            // ì‹¬ë°•ìˆ˜ ê²½ê³  ì²´í¬
            checkHeartRateAlert(heartRate);
        }

        function checkHeartRateAlert(heartRate) {
            const minHeartRate = parseInt(document.getElementById('minHeartRate').value) || 80;
            const maxHeartRate = parseInt(document.getElementById('maxHeartRate').value) || 120;
            const alertElement = document.getElementById('heartRateAlert');

            if (heartRate > maxHeartRate) {
                alertElement.textContent = `ê²½ê³ : ì‹¬ë°•ìˆ˜ê°€ ì„¤ì •ëœ ìµœëŒ€ê°’(${maxHeartRate})ì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. ì‘ì—… ê°•ë„ë¥¼ ì¡°ì ˆí•´ì£¼ì„¸ìš”.`;
                alertElement.className = 'heart-rate-alert danger';
                alertElement.style.display = 'block';
            } else if (heartRate < minHeartRate) {
                alertElement.textContent = `ì£¼ì˜: ì‹¬ë°•ìˆ˜ê°€ ì„¤ì •ëœ ìµœì†Œê°’(${minHeartRate}) ë¯¸ë§Œì…ë‹ˆë‹¤.`;
                alertElement.className = 'heart-rate-alert warning';
                alertElement.style.display = 'block';
            } else {
                alertElement.style.display = 'none';
            }
        }

        function setupHeartRateInputs() {
            const minInput = document.getElementById('minHeartRate');
            const maxInput = document.getElementById('maxHeartRate');

            minInput.addEventListener('change', validateHeartRateRange);
            maxInput.addEventListener('change', validateHeartRateRange);
        }

        function validateHeartRateRange() {
            const minHeartRate = parseInt(document.getElementById('minHeartRate').value) || 80;
            const maxHeartRate = parseInt(document.getElementById('maxHeartRate').value) || 120;

            if (minHeartRate > maxHeartRate) {
                alert('ìµœì†Œ ì‹¬ë°•ìˆ˜ëŠ” ìµœëŒ€ ì‹¬ë°•ìˆ˜ë³´ë‹¤ ì‘ì•„ì•¼ í•©ë‹ˆë‹¤.');
                document.getElementById('minHeartRate').value = maxHeartRate;
            }

            if (maxHeartRate < minHeartRate) {
                alert('ìµœëŒ€ ì‹¬ë°•ìˆ˜ëŠ” ìµœì†Œ ì‹¬ë°•ìˆ˜ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤.');
                document.getElementById('maxHeartRate').value = minHeartRate;
            }
        }

        function updateHeartRateStatus(heartRate) {
            const statusElement = document.getElementById('heartRateStatus');
            statusElement.className = 'heart-rate-status';
            
            if (heartRate < 60) {
                statusElement.textContent = 'ì‹¬ë°•ìˆ˜ ë‚®ìŒ';
                statusElement.classList.add('warning');
            } else if (heartRate <= 100) {
                statusElement.textContent = 'ì •ìƒ';
                statusElement.classList.add('normal');
            } else if (heartRate <= 120) {
                statusElement.textContent = 'ì‹¬ë°•ìˆ˜ ë†’ìŒ';
                statusElement.classList.add('warning');
            } else {
                statusElement.textContent = 'ìœ„í—˜';
                statusElement.classList.add('danger');
            }
        }

        function updateHeartRateChart() {
            const chartElement = document.getElementById('heartRateChart');
            chartElement.innerHTML = '';
            
            const maxHeartRate = Math.max(...heartRateHistory, 100);
            const barWidth = chartElement.clientWidth / MAX_HISTORY;
            
            heartRateHistory.forEach((rate, index) => {
                const bar = document.createElement('div');
                bar.className = 'heart-rate-bar';
                bar.style.left = `${index * barWidth}px`;
                bar.style.height = `${(rate / maxHeartRate) * 100}%`;
                
                // ì‹¬ë°•ìˆ˜ ìˆ˜ì¤€ì— ë”°ë¥¸ ìƒ‰ìƒ ì„¤ì •
                if (rate > 120) {
                    bar.style.background = '#f44336';
                } else if (rate > 100) {
                    bar.style.background = '#FF9800';
                } else {
                    bar.style.background = '#4CAF50';
                }
                
                chartElement.appendChild(bar);
            });
        }

        function updateWatchStatus(connected) {
            const statusIndicator = document.getElementById('watchStatus');
            const statusText = document.getElementById('watchStatusText');
            
            if (connected) {
                statusIndicator.classList.add('status-connected');
                statusText.textContent = 'ì›Œì¹˜ ì—°ê²°ë¨';
            } else {
                statusIndicator.classList.remove('status-connected');
                statusText.textContent = 'ì›Œì¹˜ ì—°ê²° ëŒ€ê¸°ì¤‘';
            }
        }

        function renderWorkTypes() {
            const mainScreen = document.getElementById('mainScreen');
            mainScreen.innerHTML = `
                <div class="watch-card">
                    <div class="watch-status">
                        <div class="watch-info">
                            <div class="status-indicator" id="watchStatus"></div>
                            <span id="watchStatusText">ì›Œì¹˜ ì—°ê²° ëŒ€ê¸°ì¤‘</span>
                        </div>
                    </div>
                    <div class="heart-rate-display">
                        <div class="heart-rate-value">
                            <span>â¤ï¸</span>
                            <span id="heartRate">--</span>
                            <span>bpm</span>
                        </div>
                        <div class="heart-rate-status" id="heartRateStatus">ì—°ê²° ëŒ€ê¸°ì¤‘</div>
                    </div>
                    <div class="heart-rate-chart" id="heartRateChart"></div>
                    <div class="heart-rate-info">
                        <div class="heart-rate-range">
                            <div class="range-item">
                                <div class="range-dot range-normal"></div>
                                <span>ì •ìƒ (60-100)</span>
                            </div>
                            <div class="range-item">
                                <div class="range-dot range-warning"></div>
                                <span>ì£¼ì˜ (100-120)</span>
                            </div>
                            <div class="range-item">
                                <div class="range-dot range-danger"></div>
                                <span>ìœ„í—˜ (150+)</span>
                            </div>
                        </div>
                        <div id="lastUpdate">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: --:--:--</div>
                    </div>
                    <div class="watch-controls">
                        <button class="watch-button connect-button" id="connectWatch">ì›Œì¹˜ ì—°ê²°</button>
                        <button class="watch-button disconnect-button" id="disconnectWatch">ì—°ê²° í•´ì œ</button>
                    </div>
                </div>
            `;
            
            document.getElementById('connectWatch').addEventListener('click', connectWatch);
            document.getElementById('disconnectWatch').addEventListener('click', disconnectWatch);
            
            const workTypesContainer = document.createElement('div');
            workTypesContainer.style.display = 'flex';
            workTypesContainer.style.flexDirection = 'column';
            workTypesContainer.style.gap = '20px';
            
            workTypes.forEach(workType => {
                const card = document.createElement('div');
                card.className = 'work-type-card';
                card.style.borderLeft = `4px solid ${workType.color}`;
                card.onclick = () => showWorkDetail(workType.id);
                
                card.innerHTML = `
                    <h2>${workType.icon} ${workType.title}</h2>
                    <p>${workType.description}</p>
                `;
                
                workTypesContainer.appendChild(card);
            });

            const myInfoCard = document.createElement('div');
            myInfoCard.className = 'my-info-card';
            myInfoCard.onclick = showHistory;
            myInfoCard.innerHTML = `
                <h2>ğŸ“Š ë‚´ ì •ë³´</h2>
                <p>ë‚˜ì˜ ì‘ì—… ê¸°ë¡ í™•ì¸í•˜ê¸°</p>
            `;
            workTypesContainer.appendChild(myInfoCard);
            
            mainScreen.appendChild(workTypesContainer);
        }

        function showWorkDetail(workId) {
            const workType = workTypes.find(w => w.id === workId);
            if (!workType) return;

            document.getElementById('detailScreen').style.display = 'block';
            document.getElementById('detailTitle').textContent = `${workType.icon} ${workType.title}`;
            
            const content = document.getElementById('detailContent');
            content.innerHTML = `
                <h3>ì‘ì—… ì„¤ëª…</h3>
                <p>${workType.description}</p>
                
                <h3>í•„ìš” ì—­ëŸ‰</h3>
                <ul>${workType.requirements.map(req => `<li>${req}</li>`).join('')}</ul>
                
                <h3>ì‘ì—…ì‹œ ìœ ì˜ì‚¬í•­</h3>
                <ul>${workType.precautions.map(prec => `<li>${prec}</li>`).join('')}</ul>
                
                <h3>í•„ìš” ì¥ë¹„</h3>
                <ul>${workType.equipment.map(equip => `<li>${equip}</li>`).join('')}</ul>
                
                <div class="fatigue-controls">
                    <div class="heart-rate-settings">
                        <h3>ì‹¬ë°•ìˆ˜ ì„¤ì •</h3>
                        <p>ì—°ë ¹ë³„ ì ì • ì‹¬ë°•ìˆ˜ ì•ˆë‚´</p>
                        <table class="heart-rate-table">
                            <tr>
                                <th>ì—°ë ¹ (ì„¸)</th>
                                <th>ì¤‘ë“±ë„ ê°•ë„ ëª©í‘œ ë²”ìœ„ (50-70% bpm)</th>
                                <th>ê³ ê°•ë„ ëª©í‘œ ë²”ìœ„ (70-85% bpm)</th>
                            </tr>
                            <tr>
                                <td>20</td>
                                <td>100 - 140</td>
                                <td>140 - 170</td>
                            </tr>
                            <tr>
                                <td>30</td>
                                <td>95 - 133</td>
                                <td>133 - 162</td>
                            </tr>
                            <tr>
                                <td>40</td>
                                <td>90 - 126</td>
                                <td>126 - 153</td>
                            </tr>
                            <tr>
                                <td>50</td>
                                <td>85 - 119</td>
                                <td>119 - 145</td>
                            </tr>
                            <tr>
                                <td>60</td>
                                <td>80 - 112</td>
                                <td>112 - 136</td>
                            </tr>
                            <tr>
                                <td>70</td>
                                <td>75 - 105</td>
                                <td>105 - 128</td>
                            </tr>
                        </table>
                        <div class="heart-rate-range-inputs">
                            <div class="heart-rate-range-input">
                                <label>ìµœì†Œ ì‹¬ë°•ìˆ˜:</label>
                                <input type="number" id="minHeartRate" min="60" max="200" value="80">
                            </div>
                            <div class="heart-rate-range-input">
                                <label>ìµœëŒ€ ì‹¬ë°•ìˆ˜:</label>
                                <input type="number" id="maxHeartRate" min="60" max="200" value="120">
                            </div>
                        </div>
                        <div class="heart-rate-alert" id="heartRateAlert"></div>
                    </div>

                    <h3>í”¼ë¡œë„ ë¶„ì„</h3>
                    <h4>ì „ë°˜ì ì¸ í”¼ë¡œë„</h4>
                    <div>
                        <label>ì‹ ì²´ì  í”¼ë¡œë„: <span id="physicalValue">${workType.initialFatigue.physical}</span>%</label>
                        <input type="range" class="fatigue-slider" id="physical" value="${workType.initialFatigue.physical}" min="0" max="100">
                    </div>
                    <div>
                        <label>ì •ì‹ ì  í”¼ë¡œë„: <span id="mentalValue">${workType.initialFatigue.mental}</span>%</label>
                        <input type="range" class="fatigue-slider" id="mental" value="${workType.initialFatigue.mental}" min="0" max="100">
                    </div>
                    <div>
                        <label>ìŠ¤íŠ¸ë ˆìŠ¤ ìˆ˜ì¤€: <span id="stressValue">${workType.initialFatigue.stress}</span>%</label>
                        <input type="range" class="fatigue-slider" id="stress" value="${workType.initialFatigue.stress}" min="0" max="100">
                    </div>
                    
                    <h4>ì‹ ì²´ ë¶€ìœ„ë³„ í”¼ë¡œë„</h4>
                    <div>
                        <label>ëª©: <span id="neckValue">${workType.initialFatigue.bodyParts.neck}</span>%</label>
                        <input type="range" class="fatigue-slider" id="neck" value="${workType.initialFatigue.bodyParts.neck}" min="0" max="100">
                    </div>
                    <div>
                        <label>í—ˆë¦¬: <span id="backValue">${workType.initialFatigue.bodyParts.back}</span>%</label>
                        <input type="range" class="fatigue-slider" id="back" value="${workType.initialFatigue.bodyParts.back}" min="0" max="100">
                    </div>
                    <div>
                        <label>ì–´ê¹¨: <span id="shoulderValue">${workType.initialFatigue.bodyParts.shoulder}</span>%</label>
                        <input type="range" class="fatigue-slider" id="shoulder" value="${workType.initialFatigue.bodyParts.shoulder}" min="0" max="100">
                    </div>
                    <div>
                        <label>ë‹¤ë¦¬: <span id="legValue">${workType.initialFatigue.bodyParts.leg}</span>%</label>
                        <input type="range" class="fatigue-slider" id="leg" value="${workType.initialFatigue.bodyParts.leg}" min="0" max="100">
                    </div>
                    <div>
                        <label>ì†ëª©: <span id="wristValue">${workType.initialFatigue.bodyParts.wrist}</span>%</label>
                        <input type="range" class="fatigue-slider" id="wrist" value="${workType.initialFatigue.bodyParts.wrist}" min="0" max="100">
                    </div>
                    
                    <button class="save-button" onclick="saveFatigueData('${workType.id}')">ì €ì¥</button>
                </div>
            `;
            
            setupFatigueSliders();
            setupHeartRateInputs();
        }

        function setupFatigueSliders() {
            const sliders = document.querySelectorAll('.fatigue-slider');
            sliders.forEach(slider => {
                const valueSpan = document.getElementById(`${slider.id}Value`);
                slider.oninput = () => valueSpan.textContent = slider.value;
            });
        }

        function saveFatigueData(workId) {
            const fatigueData = {
                timestamp: new Date().toISOString(),
                workType: workId,
                physical: parseInt(document.getElementById('physical').value),
                mental: parseInt(document.getElementById('mental').value),
                stress: parseInt(document.getElementById('stress').value),
                bodyParts: {
                    neck: parseInt(document.getElementById('neck').value),
                    back: parseInt(document.getElementById('back').value),
                    shoulder: parseInt(document.getElementById('shoulder').value),
                    leg: parseInt(document.getElementById('leg').value),
                    wrist: parseInt(document.getElementById('wrist').value)
                },
                heartRateSettings: {
                    min: parseInt(document.getElementById('minHeartRate').value) || 80,
                    max: parseInt(document.getElementById('maxHeartRate').value) || 120
                }
            };
            
            let history = JSON.parse(localStorage.getItem('fatigueHistory') || '[]');
            history.push(fatigueData);
            localStorage.setItem('fatigueHistory', JSON.stringify(history));
            
            alert('í”¼ë¡œë„ ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        function showHistory() {
            const history = JSON.parse(localStorage.getItem('fatigueHistory') || '[]');
            document.getElementById('historyScreen').style.display = 'block';
            
            const content = document.getElementById('historyContent');
            if (history.length === 0) {
                content.innerHTML = '<p>ì €ì¥ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            content.innerHTML = history.reverse().map((record, index) => {
                const workType = workTypes.find(w => w.id === record.workType);
                if (!workType) return '';
                
                return `
                    <div class="history-item" style="border-left-color: ${workType.color}" data-index="${index}">
                        <div class="delete-options">
                            <div class="delete-option" onclick="deleteRecord(${index})">ì´ ê¸°ë¡ ì‚­ì œ</div>
                            <div class="delete-option delete-all" onclick="deleteAllRecords()">ì „ì²´ ì‚­ì œ</div>
                        </div>
                        <div class="history-title">
                            <h3>${workType.icon} ${workType.title}</h3>
                        </div>
                        <p class="history-date">${new Date(record.timestamp).toLocaleString()}</p>
                        
                        <div class="fatigue-group">
                            <h4>ì‹¬ë°•ìˆ˜ ì„¤ì •</h4>
                            <div class="fatigue-label">
                                <span>ì„¤ì • ë²”ìœ„: ${record.heartRateSettings?.min || 80} - ${record.heartRateSettings?.max || 120} bpm</span>
                            </div>
                            <div class="fatigue-bar-container">
                                <div class="fatigue-bar" style="width: 100%; background-color: #e91e63;"></div>
                            </div>
                        </div>

                        <div class="fatigue-group">
                            <h4>ì „ë°˜ì ì¸ í”¼ë¡œë„</h4>
                            <div class="fatigue-label">
                                <span>ì‹ ì²´ì  í”¼ë¡œë„ ${record.physical}%</span>
                            </div>
                            <div class="fatigue-bar-container">
                                <div class="fatigue-bar" style="width: ${record.physical}%; background-color: #4CAF50;"></div>
                            </div>
                            
                            <div class="fatigue-label">
                                <span>ì •ì‹ ì  í”¼ë¡œë„ ${record.mental}%</span>
                            </div>
                            <div class="fatigue-bar-container">
                                <div class="fatigue-bar" style="width: ${record.mental}%; background-color: #2196F3;"></div>
                            </div>
                            
                            <div class="fatigue-label">
                                <span>ìŠ¤íŠ¸ë ˆìŠ¤ ìˆ˜ì¤€ ${record.stress}%</span>
                            </div>
                            <div class="fatigue-bar-container">
                                <div class="fatigue-bar" style="width: ${record.stress}%; background-color: #FF9800;"></div>
                            </div>
                        </div>
                        
                        <div class="fatigue-group">
                            <h4>ì‹ ì²´ ë¶€ìœ„ë³„ í”¼ë¡œë„</h4>
                            <div class="fatigue-label">
                                <span>ëª© ${record.bodyParts.neck}%</span>
                            </div>
                            <div class="fatigue-bar-container">
                                <div class="fatigue-bar" style="width: ${record.bodyParts.neck}%; background-color: #9C27B0;"></div>
                            </div>
                            
                            <div class="fatigue-label">
                                <span>í—ˆë¦¬ ${record.bodyParts.back}%</span>
                            </div>
                            <div class="fatigue-bar-container">
                                <div class="fatigue-bar" style="width: ${record.bodyParts.back}%; background-color: #9C27B0;"></div>
                            </div>
                            
                            <div class="fatigue-label">
                                <span>ì–´ê¹¨ ${record.bodyParts.shoulder}%</span>
                            </div>
                            <div class="fatigue-bar-container">
                                <div class="fatigue-bar" style="width: ${record.bodyParts.shoulder}%; background-color: #9C27B0;"></div>
                            </div>
                            
                            <div class="fatigue-label">
                                <span>ë‹¤ë¦¬ ${record.bodyParts.leg}%</span>
                            </div>
                            <div class="fatigue-bar-container">
                                <div class="fatigue-bar" style="width: ${record.bodyParts.leg}%; background-color: #9C27B0;"></div>
                            </div>
                            
                            <div class="fatigue-label">
                                <span>ì†ëª© ${record.bodyParts.wrist}%</span>
                            </div>
                            <div class="fatigue-bar-container">
                                <div class="fatigue-bar" style="width: ${record.bodyParts.wrist}%; background-color: #9C27B0;"></div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            setupLongPressEvents();
        }

        function setupLongPressEvents() {
            const historyItems = document.querySelectorAll('.history-item');
            let pressTimer;
            let isLongPress = false;

            historyItems.forEach(item => {
                // í„°ì¹˜ ì´ë²¤íŠ¸
                item.addEventListener('touchstart', (e) => {
                    pressTimer = setTimeout(() => {
                        showDeleteOptions(item);
                        isLongPress = true;
                    }, 500);
                });

                item.addEventListener('touchend', () => {
                    clearTimeout(pressTimer);
                    if (!isLongPress) {
                        hideAllDeleteOptions();
                    }
                    isLongPress = false;
                });

                // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸
                item.addEventListener('mousedown', (e) => {
                    pressTimer = setTimeout(() => {
                        showDeleteOptions(item);
                        isLongPress = true;
                    }, 500);
                });

                item.addEventListener('mouseup', () => {
                    clearTimeout(pressTimer);
                    if (!isLongPress) {
                        hideAllDeleteOptions();
                    }
                    isLongPress = false;
                });

                item.addEventListener('mouseleave', () => {
                    clearTimeout(pressTimer);
                });
            });

            // ë‹¤ë¥¸ ê³³ í´ë¦­ ì‹œ ì‚­ì œ ì˜µì…˜ ìˆ¨ê¸°ê¸°
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.history-item')) {
                    hideAllDeleteOptions();
                }
            });
        }

        function showDeleteOptions(item) {
            hideAllDeleteOptions();
            const deleteOptions = item.querySelector('.delete-options');
            if (deleteOptions) {
                deleteOptions.style.display = 'block';
            }
        }

        function hideAllDeleteOptions() {
            document.querySelectorAll('.delete-options').forEach(options => {
                options.style.display = 'none';
            });
        }

        function deleteRecord(index) {
            if (confirm('ì´ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                let history = JSON.parse(localStorage.getItem('fatigueHistory') || '[]');
                history.splice(history.length - 1 - index, 1);
                localStorage.setItem('fatigueHistory', JSON.stringify(history));
                showHistory();
            }
        }

        function deleteAllRecords() {
            if (confirm('ëª¨ë“  ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('fatigueHistory');
                showHistory();
            }
        }

        function showMainScreen() {
            document.getElementById('detailScreen').style.display = 'none';
            document.getElementById('historyScreen').style.display = 'none';
        }

        window.onload = renderWorkTypes;
    </script>
</body>
</html> 